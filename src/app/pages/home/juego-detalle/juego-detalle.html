<div class="steam-container">
  <div *ngIf="cargando" class="status-info">Cargando detalles...</div>
  <div *ngIf="error" class="error-banner">{{ error }}</div>

  <div *ngIf="juego" class="game-page">
    <header class="game-header">
      <h1>{{ juego.nombreJuego }}</h1>
    </header>

    <div class="game-content-layout">
      <div class="main-body">
        <img [src]="juego.urlImagen" class="game-hero" (error)="onImgError($event)">
        
        <div class="description-section">
          <h3>Acerca de este juego</h3>
          <p>{{ juego.descripcion }}</p>
        </div>

        <div class="game-meta-grid">
          <div class="meta-item">
            <span class="price-label">Precio</span>
            <span class="price-value">Q {{ juego.precio | number:'1.2-2' }}</span>
          </div>
          <div class="meta-item">
            <span>Categoría:</span>
            <span>{{ nombreCategoria }}</span>
          </div>
          <div class="meta-item">
            <span>Clasificación:</span>
            <span class="badge-simple">{{ nombreClasificacion }}</span>
          </div>
          <div class="meta-item">
            <span>Estado:</span>
            <span [class.status-on]="juego.enVenta">{{ juego.enVenta ? 'Disponible' : 'No disponible' }}</span>
          </div>
        </div>

        <div *ngIf="gruposDisponibles.length > 0" class="loan-section">
          <h4>Bibliotecas Familiares</h4>
          <p>{{ mensajePrestamo }}</p>
          <div class="loan-list">
            <div *ngFor="let mail of gruposDisponibles" class="loan-row">
              <span>{{ mail }}</span>
              <button (click)="confirmarPrestamo(mail)" class="btn-small">Pedir</button>
            </div>
          </div>
        </div>

        <div class="actions-group">
          <button *ngIf="true" [disabled]="comprado || tienePrestamoActivo || !juego.enVenta" (click)="comprarJuego()" class="btn-success">Comprar</button>
          <button *ngIf="!comprado && !tienePrestamoActivo" (click)="prestarJuego()" class="btn-primary">Pedir Prestado</button>
          <button *ngIf="comprado && !instalado" (click)="instalarJuego()" class="btn-primary">Instalar</button>
          <button *ngIf="tienePrestamoActivo" (click)="devolverJuego()" class="btn-danger">Devolver</button>
          <button *ngIf="comprado && instalado" (click)="desinstalarJuego()" class="btn-secondary">Desinstalar</button>
        </div>
      </div>
    </div>

    <section class="reviews-area">
      <h3>Reseñas de la comunidad</h3>

      <div *ngIf="comprado" class="review-editor-box">
        <label>Escribe una reseña</label>
        <textarea [(ngModel)]="nuevoComentario" class="dark-textarea" placeholder="¿Qué te pareció el juego?"></textarea>
        
        <div class="editor-footer">
          <div class="rating-box">
            <span>Valoración:</span>
            <select [(ngModel)]="calificacionJuego" class="dark-select">
              <option *ngFor="let n of [5,4,3,2,1]" [value]="n">{{n}} / 5</option>
            </select>
          </div>
          <button (click)="publicarComentario()" class="btn-primary" [disabled]="!nuevoComentario.trim()">Publicar</button>
        </div>
      </div>

      <div class="comments-list">
        <app-comentario
          *ngFor="let c of comentariosRaiz"
          [comentario]="c"
          [puedeResponder]="comprado"
          [nombreJuego]="juego.nombreJuego"
          (comentarioOcultado)="cargarComentarios(juego.id)"
        ></app-comentario>
      </div>
    </section>
  </div>
</div>