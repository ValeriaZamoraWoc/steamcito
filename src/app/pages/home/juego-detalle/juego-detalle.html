<div class="steam-container">
  <div *ngIf="cargando" class="loading-state">
    <div class="spinner"></div>
    <p>Cargando detalles del juego...</p>
  </div>
  <div *ngIf="error" class="error-banner">{{ error }}</div>

  <div *ngIf="juego" class="game-page">
    <header class="game-header">
      <h1>{{ juego.nombreJuego }}</h1>
    </header>

    <div class="game-content">
      <div class="main-column">
        <div class="image-wrapper">
          <img [src]="juego.urlImagen" class="game-hero" (error)="onImgError($event)">
        </div>
        <div class="description-box">
          <h3>Acerca de este juego</h3>
          <p>{{ juego.descripcion }}</p>
        </div>
      </div>

      <aside class="side-column">
        <div class="info-card">
          <div class="price-tag">
            <span class="currency">Q</span>
            <span class="amount">{{ juego.precio | number:'1.2-2' }}</span>
          </div>

          <div class="meta-data">
            <p><strong>Lanzamiento:</strong> {{ juego.fechaLanzamiento | date:'dd/MM/yyyy' }}</p>
            
            <div class="tags-container">
              <p *ngIf="nombreCategoria" class="meta-tag">
                <span class="tag-label">Categor√≠a:</span>
                <span class="tag-value">{{ nombreCategoria }}</span>
              </p>

              <p *ngIf="nombreClasificacion" class="meta-tag">
                <span class="tag-label">Clasificaci√≥n:</span>
                <span class="tag-value badge-age">{{ nombreClasificacion }}</span>
              </p>
            </div>

            <p [class.status-on]="juego.enVenta" [class.status-off]="!juego.enVenta" class="availability">
              {{ juego.enVenta ? '‚úÖ Disponible en tienda' : 'üö´ No disponible' }}
            </p>
          </div>

          <div class="actions-panel">
            <button *ngIf="!comprado && !tienePrestamoActivo" (click)="comprarJuego()" class="btn-steam-green">Comprar</button>
            <button *ngIf="!comprado && !tienePrestamoActivo" (click)="prestarJuego()" class="btn-steam-blue">Pedir Prestado</button>
            <button *ngIf="comprado && !instalado" (click)="instalarJuego()" class="btn-steam-blue">Instalar</button>
            <button *ngIf="tienePrestamoActivo" (click)="devolverJuego()" class="btn-steam-red">Devolver</button>
            <button *ngIf="comprado && instalado" (click)="desinstalarJuego()" class="btn-steam-gray">Desinstalar</button>
          </div>
        </div>

        <div *ngIf="gruposDisponibles.length > 0" class="loan-alert">
          <h4><span class="icon">üèòÔ∏è</span> Pr√©stamos Familiares</h4>
          <p>{{ mensajePrestamo }}</p>
          <div class="loan-list">
            <div *ngFor="let mail of gruposDisponibles" class="loan-item">
              <span class="owner-mail">{{ mail }}</span>
              <button (click)="confirmarPrestamo(mail)" class="btn-mini-loan">Pedir</button>
            </div>
          </div>
        </div>
      </aside>
    </div>

    <section class="reviews-section">
      <div class="section-title">
        <h3>Rese√±as de la comunidad</h3>
      </div>

      <div *ngIf="comprado" class="write-review-container">
  <div class="review-editor">
    <div class="editor-header">
      <span class="user-action-text">Escribe una rese√±a para {{ juego?.nombreJuego }}</span>
      <span class="review-tip">Describe qu√© te gust√≥ y qu√© no de este t√≠tulo</span>
    </div>
    
    <textarea 
      [(ngModel)]="nuevoComentario" 
      class="steam-textarea"
      placeholder="Escribe tu opini√≥n aqu√≠..."
      rows="5">
    </textarea>

    <div class="review-footer-bar">
      <div class="rating-selector">
        <label>¬øLo recomiendas?</label>
        <div class="select-style">
          <select [(ngModel)]="calificacionJuego">
            <option [value]="5">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê Excelente</option>
            <option [value]="4">‚≠ê‚≠ê‚≠ê‚≠ê Muy bueno</option>
            <option [value]="3">‚≠ê‚≠ê‚≠ê Promedio</option>
            <option [value]="2">‚≠ê‚≠ê Malo</option>
            <option [value]="1">‚≠ê Horrible</option>
          </select>
        </div>
      </div>
      
      <button 
        (click)="publicarComentario()" 
        class="btn-post-review" 
        [disabled]="!nuevoComentario.trim()">
        Publicar rese√±a
      </button>
    </div>
  </div>
</div>

      <div *ngIf="!comprado" class="not-allowed-review">
        <p>üîí Debes tener este juego en tu biblioteca para publicar una rese√±a.</p>
      </div>

      <div class="comments-container">
        <div *ngIf="comentariosRaiz.length === 0" class="no-comments">
          <p>A√∫n no hay rese√±as. ¬°S√© el primero en opinar!</p>
        </div>

        <app-comentario
          *ngFor="let c of comentariosRaiz"
          [comentario]="c"
          [puedeResponder]="comprado"
          [nombreJuego]="juego.nombreJuego"
          (comentarioOcultado)="cargarComentarios(juego.id)"
        ></app-comentario>
      </div>
    </section>
  </div>
</div>